<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Shiiro Bot — Dibuat oleh Fathan 8D</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root {
      --bg: #0f0f0f;
      --card-bg: rgba(30, 30, 30, 0.7);
      --text: #ffffff;
      --text-secondary: #b0b0b0;
      --accent: #00d4ff;
      --accent-pink: #ff2a6d;
      --accent-glow: 0 0 20px rgba(0, 212, 255, 0.6);
      --border-radius: 18px;
      --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    .light-mode {
      --bg: #f8f9fa;
      --card-bg: rgba(255, 255, 255, 0.9);
      --text: #121212;
      --text-secondary: #555;
      --accent: #00b4d8;
      --accent-glow: 0 0 15px rgba(0, 180, 216, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(0, 212, 255, 0.05) 0%, transparent 50%);
      transition: var(--transition);
    }

    /* Header */
    .header {
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(12px);
      background: rgba(20, 20, 20, 0.6);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .logo {
      font-size: 22px;
      font-weight: 800;
      background: linear-gradient(90deg, var(--accent), var(--accent-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo i {
      font-size: 24px;
    }

    .menu-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.08);
      border: none;
      color: var(--text);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .menu-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: rotate(90deg);
    }

    /* Menu Dropdown */
    .menu-dropdown {
      position: absolute;
      top: 70px;
      right: 20px;
      background: var(--card-bg);
      backdrop-filter: blur(16px);
      border-radius: var(--border-radius);
      padding: 16px 0;
      min-width: 220px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: var(--transition);
      z-index: 1000;
    }

    .menu-toggle.active + .menu-dropdown {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .menu-item {
      padding: 14px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text);
      transition: var(--transition);
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-left: 3px solid var(--accent);
      transform: translateX(4px);
    }

    .menu-item i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    /* Chat Container */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 20px;
      overflow-y: auto;
      margin-top: 10px;
      scroll-behavior: smooth;
    }

    .message {
      max-width: 85%;
      padding: 16px 20px;
      margin: 12px 0;
      border-radius: var(--border-radius);
      line-height: 1.6;
      position: relative;
      animation: fadeInUp 0.5s ease;
      word-wrap: break-word;
    }

    .user-message {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent-pink), #ff4757);
      color: white;
      border-bottom-right-radius: 6px;
      box-shadow: 0 4px 20px rgba(255, 42, 109, 0.3);
    }

    .ai-message {
      align-self: flex-start;
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom-left-radius: 6px;
      box-shadow: var(--accent-glow);
      backdrop-filter: blur(8px);
    }

    .ai-message .prefix {
      font-size: 12px;
      color: var(--accent);
      margin-bottom: 6px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    /* Video dalam chat */
    .ai-message video {
      width: 100%;
      max-height: 360px;
      border-radius: 12px;
      margin: 10px 0;
      background: #000;
      object-fit: cover;
    }

    /* Input Area */
    .input-area {
      padding: 16px 20px;
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      gap: 12px;
      position: sticky;
      bottom: 0;
      z-index: 99;
    }

    .input-area input {
      flex: 1;
      padding: 16px 20px;
      border-radius: var(--border-radius);
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(30, 30, 30, 0.6);
      color: var(--text);
      font-size: 16px;
      outline: none;
      transition: var(--transition);
    }

    .input-area input:focus {
      border-color: var(--accent);
      box-shadow: var(--accent-glow);
    }

    .input-area button {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: var(--accent);
      color: #000;
      border: none;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
    }

    .input-area button:hover {
      transform: scale(1.08) rotate(15deg);
      box-shadow: 0 6px 25px rgba(0, 212, 255, 0.6);
    }

    /* Typing Indicator */
    .typing {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 12px 20px;
      color: var(--text-secondary);
      font-size: 14px;
      align-self: flex-start;
    }

    .typing span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      animation: pulse 1.5s infinite;
    }

    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes pulse {
      0%, 100% { transform: scale(0.8); opacity: 0.5; }
      50% { transform: scale(1.2); opacity: 1; }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header { padding: 12px 16px; }
      .logo { font-size: 20px; }
      .menu-btn { width: 40px; height: 40px; }
      .message { max-width: 92%; }
      .input-area { padding: 12px 16px; }
      .input-area input { padding: 14px 16px; }
      .input-area button { width: 48px; height: 48px; }
    }

    /* Toast */
    @keyframes slideUp {
      from { transform: translate(-50%, 20px); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <i class="fas fa-robot"></i> Shiiro Bot
    </div>
    <button class="menu-btn menu-toggle" id="menuToggle">=</button>
    <div class="menu-dropdown" id="menuDropdown">
      <div class="menu-item" id="themeToggle">
        <i class="fas fa-sun"></i> Ubah ke Mode Terang
      </div>
      <div class="menu-item" id="keyToggle">
        <i class="fas fa-key"></i> Ubah API Key
      </div>
      <div class="menu-item" id="creditBtn">
        <i class="fas fa-code"></i> Credit
      </div>
    </div>
  </div>

  <!-- Chat Area -->
  <div class="chat-container" id="chatContainer">
    <div class="message ai-message">
      <div class="prefix">Shiiro Bot</div>
      <!-- VIDEO LANGSUNG DARI CATBOX — AUTOPLAY + BERSUARA -->
      <video 
        controls 
        autoplay 
        playsinline
        src="https://files.catbox.moe/6sdcsk.mp4"
        style="width:100%; max-height:360px; border-radius:12px; margin-bottom:16px; background:#000;">
        Browser Anda tidak mendukung pemutaran video.
      </video>
      <!-- TEKS MENU DI BAWAH VIDEO -->
      <div>
        🇬🇧 ► Hello user ✨, welcome to Shiiro Bot, I'm here to assist you<br>
        🇳🇴 ► Hei bruker ✨, velkommen til Shiiro Bot, jeg er her for å hjelpe deg<br><br>
        ┏━━❍ 𝗠𝗔𝗜𝗡 𝗠𝗘𝗡𝗨 ✨<br>
        ┣━❒ /ai <perintah><br>
        ┣━❒ /developerbot<br>
        ┣━❒ /ngl<br>
        ┗━━━━━━━━━━━━━━━━━━━━<br><br>
        𝗣𝗹𝗲𝗮𝘀𝗲 𝗰𝗵𝗼𝗼𝘀𝗲 𝗼𝗻𝗲 𝗼𝗳 𝘁𝗵𝗲 𝗳𝗼𝗹𝗹𝗼𝘄𝗶𝗻𝗴 𝗺𝗲𝗻𝘂 𝗼𝗽𝘁𝗶𝗼𝗻𝘀. 👻
      </div>
    </div>
  </div>

  <!-- Input -->
  <div class="input-area">
    <input type="text" id="userInput" placeholder="Tulis pesanmu..." autocomplete="off" />
    <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
  </div>

  <script>
    // CONFIG — OPENROUTER + QWEN (SUDAH DIPERBAIKI: HAPUS SPASI DI AKHIR URL)
    const DEFAULT_API_KEY = "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";
    const API_ENDPOINT = "https://openrouter.ai/api/v1/chat/completions"; // ✅ FIX: hapus spasi di akhir

    const YOUR_SITE_URL = window.location.href;
    const YOUR_SITE_NAME = "Shiiro Bot by Fathan 8D";

    // DOM
    const chatContainer = document.getElementById('chatContainer');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const menuToggle = document.getElementById('menuToggle');
    const menuDropdown = document.getElementById('menuDropdown');
    const themeToggle = document.getElementById('themeToggle');
    const keyToggle = document.getElementById('keyToggle');
    const creditBtn = document.getElementById('creditBtn');

    // Toggle Menu
    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
    });

    // Theme Toggle
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      if (document.body.classList.contains('light-mode')) {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i> Ubah ke Mode Gelap';
      } else {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i> Ubah ke Mode Terang';
      }
    });

    // API Key Handler
    keyToggle.addEventListener('click', async () => {
      const savedKey = localStorage.getItem('apiKey') || DEFAULT_API_KEY;
      const newKey = prompt("🔑 Masukkan OpenRouter API Key Baru:", savedKey);
      if (newKey && newKey.trim()) {
        localStorage.setItem('apiKey', newKey.trim());
        showToast("✅ API Key berhasil diperbarui!");
      } else {
        if (confirm("Lupa API Key? Klik OK untuk salin default.")) {
          try {
            await navigator.clipboard.writeText(DEFAULT_API_KEY);
            showToast("📋 Disalin ke clipboard!");
          } catch (err) {
            alert("Salin manual:\n" + DEFAULT_API_KEY);
          }
        }
      }
    });

    // Navigate to credit.html
    creditBtn.addEventListener('click', () => {
      window.location.href = 'credit.html';
    });

    // Chat Functions
    function addMessage(content, isUser = false) {
      const div = document.createElement('div');
      div.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
      if (!isUser) {
        div.innerHTML = `<div class="prefix">Shiiro Bot</div>${content}`;
      } else {
        div.textContent = content;
      }
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTyping() {
      const typing = document.createElement('div');
      typing.className = 'typing';
      typing.innerHTML = '<span></span><span></span><span></span>';
      chatContainer.appendChild(typing);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return typing;
    }

    function hideTyping(typingElement) {
      if (typingElement && typingElement.parentNode) {
        typingElement.parentNode.removeChild(typingElement);
      }
    }

    function showToast(message) {
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.style.cssText = `
          position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
          background: var(--accent); color: #000; padding: 12px 24px;
          border-radius: 30px; font-weight: 600; z-index: 3000;
          box-shadow: 0 4px 20px rgba(0, 212, 255, 0.5);
          animation: slideUp 0.6s ease forwards;
        `;
        document.body.appendChild(toast);
      }
      toast.textContent = message;
      toast.style.animation = 'none';
      setTimeout(() => { toast.style.animation = 'slideUp 0.6s ease forwards'; }, 10);
      setTimeout(() => { if (toast) toast.remove(); }, 3000);
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      addMessage(text, true);
      userInput.value = '';
      const typing = showTyping();

      try {
        let replyContent = "";

        if (text.startsWith("/ai ")) {
          const query = text.slice(4).trim();
          if (!query) {
            replyContent = "❌ Silakan berikan pertanyaan setelah `/ai`.\nContoh: `/ai siapa presiden Indonesia pertama`";
          } else {
            const apiKey = localStorage.getItem('apiKey') || DEFAULT_API_KEY;
            try {
              const res = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: {
                  'Authorization': `Bearer ${apiKey}`,
                  'Content-Type': 'application/json',
                  'HTTP-Referer': YOUR_SITE_URL,
                  'X-Title': YOUR_SITE_NAME
                },
                body: JSON.stringify({
                  model: "qwen/qwen2-72b-instruct:free", // ✅ Model gratis & stabil
                  messages: [
                    {
                      role: "system",
                      content: "Kamu adalah Shiiro Bot — asisten cerdas yang dibuat oleh Fathan 8D. Jawab dengan santai, ramah, mendalam, dan membantu. Gunakan bahasa Indonesia natural."
                    },
                    {
                      role: "user",
                      content: query
                    }
                  ],
                  temperature: 0.7,
                  max_tokens: 2000
                })
              });

              if (!res.ok) {
                const errorData = await res.json().catch(() => ({}));
                throw new Error(`API Error: ${errorData.error?.message || res.statusText}`);
              }

              const data = await res.json();
              replyContent = data.choices[0].message.content;

            } catch (err) {
              replyContent = `🤖 Maaf, terjadi kesalahan:\n> ${err.message}\n\nCoba lagi atau ganti API Key.`;
            }
          }
        } else if (text === "/developerbot") {
          replyContent = "👤 Dibuat oleh: <strong>Fathan 8D</strong>";
        } else if (text === "/ngl") {
          replyContent = `
💌 Kirim saran atau pesan anonim untukku:<br>
<a href="https://ngl.link/shiiro11661" target="_blank" style="color: var(--accent); text-decoration: underline;">https://ngl.link/shiiro11661</a><br><br>
Silakan klik dan kasih saran untuk fitur selanjutnya !!!
          `;
        } else {
          // Balasan default — video + teks menu (tanpa spasi di URL video)
          replyContent = `
<video 
  controls 
  autoplay 
  playsinline
  src="https://files.catbox.moe/6sdcsk.mp4"
  style="width:100%; max-height:300px; border-radius:12px; margin-bottom:16px; background:#000;">
  Browser Anda tidak mendukung pemutaran video.
</video>
🇬🇧 ► Hello user ✨, welcome to Shiiro Bot, I'm here to assist you<br>
🇳🇴 ► Hei bruker ✨, velkommen til Shiiro Bot, jeg er her for å hjelpe deg<br><br>
┏━━❍ 𝗠𝗔𝗜𝗡 𝗠𝗘𝗡𝗨 ✨<br>
┣━❒ /ai <perintah><br>
┣━❒ /developerbot<br>
┣━❒ /ngl<br>
┗━━━━━━━━━━━━━━━━━━━━<br><br>
𝗣𝗹𝗲𝗮𝘀𝗲 𝗰𝗵𝗼𝗼𝘀𝗲 𝗼𝗻𝗲 𝗼𝗳 𝘁𝗵𝗲 𝗳𝗼𝗹𝗹𝗼𝘄𝗶𝗻𝗴 𝗺𝗲𝗻𝘂 𝗼𝗽𝘁𝗶𝗼𝗻𝘀. 👻
          `;
        }

        hideTyping(typing);
        addMessage(replyContent);

      } catch (err) {
        hideTyping(typing);
        addMessage(`❌ Error: ${err.message}`, false);
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    // Close menu
    document.addEventListener('click', e => {
      if (!menuToggle.contains(e.target) && !menuDropdown.contains(e.target)) {
        menuToggle.classList.remove('active');
      }
    });

    // Load saved API key & coba play video
    window.onload = () => {
      const savedKey = localStorage.getItem('apiKey');
      if (savedKey) console.log("🔑 OpenRouter API Key loaded");

      const firstVideo = document.querySelector('.ai-message video');
      if (firstVideo) {
        firstVideo.play().catch(err => {
          console.warn("Autoplay diblokir oleh browser. User harus interaksi dulu.");
        });
      }
    };
  </script>
</body>
</html>
